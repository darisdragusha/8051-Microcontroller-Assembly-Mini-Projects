;TRANSMISSION CYCLIC BUFFER. READ P1, MOVE TO CYCCLC BUFFER, TRANSMIT FROM CYCLIC BUFFER. SHOW CHAR BEING TRANSMITTED AND NO. OF CHARS IN BUFFER IN P0 AND P2
	ORG	0000H
	LJMP	INIT

INIT:
	MOV	SCON, #50H
	MOV	TMOD, #20H
	MOV	TH1, #252
	MOV	R0, #30H	; BUFFER READ POINTER
	MOV	R1, #30H	; BUFFER WRITE POINTER
	MOV	R7, #00H	; COUNTER
	SETB	TR1

MAIN:
	ACALL	READ_PORT
	ACALL	UPDATE_BUFFER
	ACALL	READ_BUFFER
	ACALL	TRANSMIT_CHAR
	ACALL	DISPLAY_INFO
	SJMP	MAIN

READ_PORT:
	MOV	A, P1
	RET

UPDATE_BUFFER:
	MOV	@R1, A
	INC	R1
	INC	R7
	CJNE	R1, #38, NO_WRAP
	MOV	R1, #30H
NO_WRAP:
	CJNE	R7, #9, NO_OVERFLOW
	DEC	R7
NO_OVERFLOW:
	RET

READ_BUFFER:
	MOV	A, @R0
	INC	R0
	CJNE	R0, #38, NO_WRAP_READ
	MOV	R0, #30H
NO_WRAP_READ:
	RET

TRANSMIT_CHAR:
	MOV	SBUF, A
	JNB	TI, $
	CLR	TI
	RET

DISPLAY_INFO:
	MOV	P0, A
	MOV	P2, R7
	RET

	END

