;RECEIVE BYTE FROM RX, WAIT FOR P2.3, TRANSMIT BYTE USING 8PS PROTOCOL WITH ODD PARITY AND 2 STOP BITS (11). DISPLAY THE BIT BEING TRANSMITTED
;P1.1 = TX, P1.2= CLK
	ORG	0000H
	LJMP	INIT
	CLK EQU P1.2

INIT:
	MOV	SCON, #50H
	MOV	TMOD, #20H
	MOV	TH1, #252
	SETB	TR1

MAIN:
	ACALL	RECEIVE_BYTE
	JNB	P2.3, $
	ACALL	TRANSMIT_BYTE
	SJMP	MAIN

RECEIVE_BYTE:
	JNB	RI, $
	MOV	A, SBUF
	CLR	RI
	RET

TRANSMIT_BYTE:
	ACALL	TRANSMIT_START_BIT
	MOV	R0, #8
ALL_BITS:
	ACALL	TRANSMIT_DATA_BIT
	DJNZ	R0, ALL_BITS
	ACALL	TRANSMIT_PARITY_BIT
	ACALL	TRANSMIT_STOP_BITS

TRANSMIT_START_BIT:
	CLR	C
	MOV	P1.1, C
	SETB	CLK
	CLR	CLK
	RET

TRANSMIT_DATA_BIT:
	RLC	A
	MOV	P1.1, C
	SETB	CLK
	CLR	CLK
	RET

TRANSMIT_PARITY_BIT:
	MOV	C, PSW.0
	CPL	C
	MOV	P1.1, C
	SETB	CLK
	CLR	CLK
	RET

TRANSMIT_STOP_BITS:
	SETB	C
	MOV	P1.1, C
	SETB	CLK
	CLR	CLK
	SETB	CLK
	CLR	CLK
	RET
